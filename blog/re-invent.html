
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Plan for Unsuccessful Changes; A Use Case of the AWS Health API">
      
      
        <meta name="author" content="Meraj Kashi">
      
      
        <link rel="canonical" href="https://cloudynotes.io/blog/re-invent.html">
      
      
      
      <link rel="icon" href="../assets/logo.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.13">
    
    
      
        <title>reInvent - CloudyNotes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ffa9267a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-53DNYVDBH4"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-53DNYVDBH4",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-53DNYVDBH4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#plan-for-unsuccessful-changes-a-use-case-of-the-aws-health-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CloudyNotes" class="md-header__button md-logo" aria-label="CloudyNotes" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CloudyNotes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              reInvent
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CloudyNotes" class="md-nav__button md-logo" aria-label="CloudyNotes" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    CloudyNotes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Blog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="main.html" class="md-nav__link">
        Latest
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="tags.html" class="md-nav__link">
        All
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#resiliency-a-shared-responsibility-in-the-cloud" class="md-nav__link">
    Resiliency: A Shared Responsibility in the Cloud
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-availability" class="md-nav__link">
    Service Availability
  </a>
  
    <nav class="md-nav" aria-label="Service Availability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#control-and-data-planes" class="md-nav__link">
    Control and Data Planes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-health" class="md-nav__link">
    AWS Health
  </a>
  
    <nav class="md-nav" aria-label="AWS Health">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#health-events" class="md-nav__link">
    Health Events
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aws-health-api-use-case" class="md-nav__link">
    AWS Health API Use Case
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#discussion" class="md-nav__link">
    Discussion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="plan-for-unsuccessful-changes-a-use-case-of-the-aws-health-api">Plan for Unsuccessful Changes; A Use Case of the AWS Health API</h1>
<p><img alt="Radlands" loading="lazy" src="https://github.com/cloudynotes/www.cloudynotes.io/blob/master/custom/img/blog/radlands/radlands.png?raw=true" /></p>
<p><audio controls>
    <source src="https://cloudynotes-podcasts.s3.eu-north-1.amazonaws.com/radlands/radlands.mp3" type="audio/mp3">
    Your browser does not support the audio element.
</audio></p>
<blockquote>
<p>Radlands is a fast-paced card game where you lead a tribe of survivors in a harsh post-apocalyptic world. 
Your tribe has settled near a rare water source and uses strange old technology from abandoned military experiments to stay alive. 
Other tribes want your water and are preparing to attack. To win, you’ll need to use your cards wisely, protect your three camps, 
and perform regular healthchecks to ensure their survival. If all your camps are destroyed, you lose. 
Radlands is all about strategy, survival, and fierce battles. For more information, visit: <a href="https://boardgamegeek.com/boardgame/329082/radlands" target="_blank">boardgamegeek</a></p>
</blockquote>
<h2 id="resiliency-a-shared-responsibility-in-the-cloud">Resiliency: A Shared Responsibility in the Cloud</h2>
<p>This blog post is inspired by the Chalk Talk session titled ARC317 - Operational Excellence: Best Practices for Resilient Systems from AWS re:Invent 2024. You can explore the presentation deck on the <a href="https://reinvent.awsevents.com/content/dam/reinvent/2024/slides/arc/ARC317_Operational-excellence-Best-practices-for-resilient-systems.pdf">AWS events content</a>.</p>
<p>According to the <strong>AWS Well-Architected Framework</strong>, resiliency is defined as the ability of a system to recover from failures caused by load, attacks, or internal faults. These failures can stem from various sources, such as hardware malfunctions, software bugs, operational errors, or environmental disruptions.</p>
<p>In the cloud era, ensuring resiliency is not solely the responsibility of cloud consumers. Instead, it operates on a <strong>shared responsibility model</strong>, where both cloud providers and customers play critical roles.</p>
<ol>
<li>
<p><strong>AWS's Responsibility: Resiliency of the Cloud</strong><br />
AWS is accountable for the resiliency of the infrastructure that powers its cloud services. This includes managing the hardware, software, networking, and facilities supporting the AWS Cloud. AWS strives to ensure high availability and service reliability, meeting or exceeding its Service Level Agreements (SLAs) through robust infrastructure management.</p>
</li>
<li>
<p><strong>Customer's Responsibility: Resiliency in the Cloud</strong><br />
Customers are responsible for configuring and managing the resiliency of their workloads running in the AWS Cloud. The scope of this responsibility depends on the AWS services they choose. For example, a fully managed service like Amazon S3 shifts much of the resiliency burden to AWS, while a self-managed virtual machine in Amazon EC2 requires the customer to implement failover strategies, backups, and other resiliency measures. </p>
</li>
</ol>
<p><img alt="shared-responsibility-of-resiliency" loading="lazy" src="https://github.com/cloudynotes/www.cloudynotes.io/blob/master/custom/img/blog/radlands/shared-responsibility-of-resiliency.png?raw=true" /></p>
<p>More details on this model can be found in the <a href="https://docs.aws.amazon.com/whitepapers/latest/disaster-recovery-workloads-on-aws/shared-responsibility-model-for-resiliency.html" target="_blank">AWS Shared Responsibility Model for Resiliency</a>.</p>
<p>This blog post explores how to integrate AWS's responsibilities with customer obligations to build resilient systems that not only meet but exceed operational excellence standards. By leveraging AWS's resilient cloud infrastructure and adopting best practices for configuring workloads, customers can achieve greater fault tolerance, reliability, and performance.</p>
<h2 id="service-availability">Service Availability</h2>
<p>Availability (also referred to as service availability) serves as both a key metric for quantitatively measuring resiliency and a target objective for achieving operational excellence. When discussing availability, several critical metrics play an essential role in understanding and improving system resiliency:</p>
<ul>
<li>
<p><strong>MTTD (Mean Time to Detect)</strong><br />
The average time it takes to identify an issue or failure in a system. Faster detection helps mitigate problems early, reducing downtime.</p>
</li>
<li>
<p><strong>MTTR (Mean Time to Repair)</strong><br />
The average time required to repair a system or component and restore it to full operational status after a failure. Minimizing MTTR ensures quicker recovery and higher availability.</p>
</li>
<li>
<p><strong>MTBF (Mean Time Between Failures)</strong><br />
The average time a system or component operates without encountering a failure. A higher MTBF reflects better overall system stability and reliability.</p>
</li>
</ul>
<p><img alt="service-availability" loading="lazy" src="https://github.com/cloudynotes/www.cloudynotes.io/blob/master/custom/img/blog/radlands/service-availability.png?raw=true" /></p>
<p>Availability can be mathematically expressed using the following equation:  </p>
<div align="center">
  <span style="font-size: 1.2em;">
    <b>Availability</b> = <b>MTBF</b> / (<b>MTBF</b> + <b>MTTR</b>)
  </span>
</div>

<p>This equation highlights the relationship between these metrics and system availability:</p>
<ul>
<li>Lower MTTD enables faster issue detection.</li>
<li>Lower MTTR facilitates quicker repairs and recovery.</li>
<li>Higher MTBF indicates a more reliable and resilient system.</li>
</ul>
<p>To grasp how AWS manages service availability, it's important to first understand the concepts of the control plane and data plane. For those with a background in networking and telecommunications, these may be familiar terms, but in the context of AWS, they have specific definitions. Let's explore these concepts in the AWS framework.</p>
<h3 id="control-and-data-planes">Control and Data Planes</h3>
<p>AWS organizes most services into two interconnected components: the control plane and the data plane. These concepts originate from networking, particularly routers. In a router, the data plane is responsible for its primary function—moving packets based on routing rules—while the control plane manages the creation and distribution of these rules. AWS applies a similar division to its cloud services.</p>
<p>The control plane provides the administrative APIs that enable the management of resources through operations like Create, Read/Describe, Update, Delete, and List (CRUDL). For example, launching an Amazon EC2 instance, creating an Amazon S3 bucket, or describing an Amazon SQS queue are all control plane actions. When you launch an EC2 instance, the control plane performs various tasks such as locating a physical host with capacity, allocating network interfaces, preparing Amazon EBS volumes, generating IAM credentials, and configuring Security Group rules. These orchestration and aggregation tasks make the control plane a complex system with many moving parts, including workflows, business logic, and databases.</p>
<p>In contrast, the data plane handles the primary functionality of a service. It operates the core activities of AWS resources, such as running an EC2 instance, reading and writing data to an EBS volume, retrieving or storing objects in an S3 bucket, or processing DNS queries and health checks with Route 53. The data plane is designed to be simpler and more streamlined than the control plane, with fewer dependencies and moving parts. This simplicity makes the data plane statistically less likely to experience failures compared to the control plane.</p>
<p>Despite their differences, the control plane and data plane are tightly connected. The data plane depends on initial provisioning and configuration performed by the control plane. However, once resources are provisioned, the data plane operates independently of the control plane, which is a key factor in achieving resiliency and availability. AWS’s separation of these components ensures performance and availability benefits.</p>
<p>The AWS Well-Architected Framework recommends relying on the data plane over the control plane during recovery, as detailed in the guidance: Rely on the data plane and not the control plane during recovery <a href="https://docs.aws.amazon.com/wellarchitected/latest/framework/rel_withstand_component_failures_avoid_control_plane.html" target="_blank">(REL11-BP04)</a>.</p>
<p>Control planes are statistically more likely to fail due to their complexity, while the data plane is designed to maintain existing states and operations even during control plane disruptions. For example: in Route 53, the control plane handles routing policies and resource management but is centralized in the US East region to ensure consistency and durability. However, the data plane, responsible for answering DNS queries and performing health checks, is globally distributed and designed for a 100% availability SLA.</p>
<p>This separation means that even if the control plane encounters an issue, existing data plane resources and operations remain unaffected, ensuring reliability.</p>
<p>For disaster recovery and failover strategies, prioritize data plane functionality to ensure continuity. Although control plane APIs and consoles provide robust tools for creating and managing resources, they are not included in SLA guarantees. In rare cases, the control plane may experience disruptions while the data plane remains fully operational.</p>
<p>For example, in Route 53, the data plane continues answering DNS queries and performing health checks even if the control plane is temporarily impaired. This design ensures the highest possible reliability for globally distributed systems.</p>
<h2 id="aws-health">AWS Health</h2>
<p>In the shared responsibility model, the availability of services running on the cloud is a collaborative effort between the cloud provider and the client. As clients, we have (typically) full control over our own services. We manage maintenance windows, monitor the availability of our resources, and address issues affecting our workloads. However, on the provider side, the cloud provider oversees their infrastructure and services. Due to this interdependent responsibility, it is crucial for customers to stay informed about the activities and status of the cloud provider.</p>
<p>AWS Health provides ongoing visibility into the performance of your resources and the availability of AWS services and accounts. Through AWS Health events, you can gain insights into how service or resource changes might impact your applications running on AWS. This service delivers relevant and timely information to help you:</p>
<ul>
<li>Manage ongoing events</li>
<li>Understand and prepare for planned activities</li>
<li>Troubleshoot issues efficiently</li>
</ul>
<p>AWS Health sends alerts and notifications triggered by changes in the health of AWS resources. These alerts provide near-instant visibility into events and offer guidance to accelerate troubleshooting, helping you minimize downtime and mitigate potential impacts. </p>
<p>All AWS customers can monitor the health of AWS services using the AWS Health Dashboard, which a personalized view of events that affect the customer AWS account or organization Additionally, customers can receive AWS Health events via Amazon EventBridge at no extra cost. This enables automated responses or seamless integration with third-party tools, enhancing incident management and operational efficiency.</p>
<p><img alt="aws-health-dashboard" loading="lazy" src="https://github.com/cloudynotes/www.cloudynotes.io/blob/master/custom/img/blog/radlands/aws-health-dashboard.png?raw=true" /></p>
<h3 id="health-events">Health Events</h3>
<p>AWS Health events, often referred to simply as Health events, are notifications sent by AWS Health on behalf of other AWS services. These events provide critical insights into upcoming or ongoing changes that could impact your AWS account. You can use these notifications to:</p>
<ul>
<li>Learn about scheduled changes or maintenance activities affecting your resources.</li>
<li>Get updates on service availability issues in a specific AWS region.</li>
</ul>
<p>Each event includes a detailed description, enabling you to understand the issue, identify affected resources, and take recommended actions to mitigate potential impacts.</p>
<p>AWS Health events are categorized into two types:</p>
<ol>
<li>
<p>Public Events
These are general service notifications not tied to a specific AWS account. For instance, if there is a service issue in an AWS region, AWS Health provides event details—even if your account does not have resources in that region.</p>
</li>
<li>
<p>Account-Specific Events
These events are tied to your AWS account or an account within your organization. For example, if an issue arises with EC2 in a region where you have resources, AWS Health sends a detailed notification about the problem, including affected resources and recommended actions.</p>
</li>
</ol>
<p>You can use Amazon EventBridge to detect and respond to AWS Health events automatically. EventBridge allows you to create rules based on event parameters, triggering one or more target actions when an event matches your specified criteria. For more details, refer to the official documentation: <a href="https://docs.aws.amazon.com/health/latest/ug/cloudwatch-events-health.html" target="_blank">AWS Health Events and Amazon EventBridge</a>.</p>
<p>While the AWS Health Tools GitHub project hasn’t been actively maintained, it still offers valuable ideas and examples for automating and integrating AWS Health notifications. You can explore the repository here: <a href="https://github.com/aws/aws-health-tools" target="_blank">AWS Health Tools GitHub</a>.</p>
<h2 id="aws-health-api-use-case">AWS Health API Use Case</h2>
<p>Let’s examine a scenario from ARC317 Chalk Talk, whitch illustrate the importance of integrating the AWS Health API:</p>
<blockquote>
<p>Between 8:00 AM and 9:00 AM, a nationwide point-of-sale (POS) system experienced 100% request failures. The root cause was a scheduled maintenance activity to upgrade a core database cluster. This maintenance, planned to complete within 15 minutes and two hours before store opening, unexpectedly overran its schedule, causing the disruption.</p>
</blockquote>
<p>In this case, the issue was caused by AWS RDS service maintenance. Although AWS was performing the maintenance in the background, the customer was unaware of this activity, leading to the upgrade being carried out at an inopportune time.</p>
<p>While customers can manually monitor service health using the AWS Health Dashboard or receive notifications through AWS Health EventBridge integration, relying on manual checks or notifications alone can leave gaps. Automation offers a more effective and proactive approach to avoiding such scenarios.</p>
<p>The AWS Health API provides programmatic access to AWS Health data, enabling applications to query service health status in real time. As a RESTful service, the API uses HTTPS for transport and JSON for message serialization, making it easy to integrate into existing workflows.</p>
<p>A common use case for the AWS Health API is integrating it into CI/CD pipelines to ensure service health before critical deployments or upgrades. In the scenario above, if the customer had queried the AWS Health API for the status of AWS RDS before starting the upgrade, they would have been alerted to the ongoing maintenance. For example, in the RDS upgrade scenario:</p>
<ol>
<li>Before initiating the upgrade job, the pipeline queries the AWS Health API to verify the health of the required AWS services (e.g., RDS).</li>
<li>If maintenance events or service issues are detected, the pipeline halts the process, notifies stakeholders, or triggers an alternative workflow.</li>
<li>If no issues are identified, the pipeline proceeds with the deployment or upgrade as planned.</li>
</ol>
<p>This proactive approach minimizes risks associated with scheduled maintenance or service disruptions, ensuring smoother operations and higher reliability.</p>
<p>When using the AWS Health API, keep the following considerations in mind:</p>
<ul>
<li><strong>Support Plan Requirements</strong> </li>
</ul>
<p>To access the AWS Health API, your account must be subscribed to a Business, Enterprise On-Ramp, or Enterprise Support plan from AWS Support.</p>
<p>If you attempt to call the AWS Health API from an account without one of these support plans, you will encounter a <code>SubscriptionRequiredException</code> error.</p>
<ul>
<li><strong>Active-Passive Regional Endpoints</strong>  </li>
</ul>
<p>The AWS Health API provides two regional endpoints in an active-passive configuration. To simplify DNS failover, AWS Health offers a single global endpoint.</p>
<p>Both the active and passive endpoints provide AWS Health data, but the latest and most accurate data is only available from the active endpoint. Data from the passive endpoint is eventually consistent. If the active endpoint changes, AWS recommend restarting any workflows to ensure consistency.</p>
<p>To identify the active endpoint, you can use the following dig commands:</p>
<pre><code>&gt; dig global.health.amazonaws.com

global.health.amazonaws.com. 10 IN CNAME health.us-east-1.amazonaws.com.
health.us-east-1.amazonaws.com. 60 IN CNAME prod.us-east-1.health-api.external.silvermine.aws.a2z.com.
</code></pre>
<p>Retrieve active endpoint directly:</p>
<pre><code>dig global.health.amazonaws.com | awk '/CNAME/ &amp;&amp; /global/ {print $5}'
</code></pre>
<ul>
<li><strong>Accessing Service Health Data</strong></li>
</ul>
<p>You can access AWS Health data using either the API or the CLI. The <a href="https://docs.aws.amazon.com/health/latest/APIReference/API_DescribeEvents.html#API_DescribeEvents_RequestSyntax" target="_blank">DescribeEvents</a> operation retrieves information about events that meet specified filter criteria. The returned data includes event summaries but does not provide detailed descriptions, metadata specific to the event type, or information about affected resources.</p>
<pre><code>aws health describe-events \
--filter &quot;services=EC2 eventStatusCodes=open,upcoming, regions=eu-north-1&quot; \
--region us-east-1
</code></pre>
<p>By using filter criteria, you can tailor the results to focus on specific services, event statuses, and regions. This is particularly useful for identifying ongoing or upcoming issues that could impact your resources and operations.</p>
<pre><code>&quot;filter&quot;: { 
      &quot;availabilityZones&quot;: [ &quot;string&quot; ],
      &quot;endTimes&quot;: [ 
         { 
            &quot;from&quot;: number,
            &quot;to&quot;: number
         }
      ],
      &quot;entityArns&quot;: [ &quot;string&quot; ],
      &quot;entityValues&quot;: [ &quot;string&quot; ],
      &quot;eventArns&quot;: [ &quot;string&quot; ],
      &quot;eventStatusCodes&quot;: [ &quot;string&quot; ],
      &quot;eventTypeCategories&quot;: [ &quot;string&quot; ],
      &quot;eventTypeCodes&quot;: [ &quot;string&quot; ],
      &quot;lastUpdatedTimes&quot;: [ 
         { 
            &quot;from&quot;: number,
            &quot;to&quot;: number
         }
      ],
      &quot;regions&quot;: [ &quot;string&quot; ],
      &quot;services&quot;: [ &quot;string&quot; ],
      &quot;startTimes&quot;: [ 
         { 
            &quot;from&quot;: number,
            &quot;to&quot;: number
         }
      ],
      &quot;tags&quot;: [ 
         { 
            &quot;string&quot; : &quot;string&quot; 
         }
      ]
   }
</code></pre>
<p>I have also provided a solution to check the status of AWS services before deploying resources. Currently, the Terraform AWS providers (both aws and awscc) do not include any data blocks for checking AWS service health. The example below demonstrates how to achieve this using Terraform in combination with a Python script:</p>
<p><strong>s3-with-health-check.tf</strong></p>
<pre><code># Terraform external data block
data &quot;external&quot; &quot;radlands&quot; {
  program = [&quot;python3&quot;, &quot;./health.py&quot;]

  query = {
    services = &quot;S3&quot;
    regions  = &quot;eu-north-1,eu-west-1&quot;
  }
}

# Terraform s3 bucket - conditional creation
resource &quot;aws_s3_bucket&quot; &quot;radlands&quot; {
  bucket = &quot;cloudynotes-io-radlands&quot;

  lifecycle {
    precondition {
      condition     = data.external.radlands.result.events == jsonencode([])
      error_message = &quot;Service health check failed: ${data.external.radlands.query.services} are not in a healthy state.&quot;
    }
  }
}

# Output health_events and active_endpoint
output &quot;health_events&quot; {
  value = data.external.radlands.result.events
}

output &quot;health_active_endpoint&quot; {
  value = data.external.radlands.result.active_aws_health_region
}

# Provider block
terraform {
  required_providers {
    external = {
      source  = &quot;hashicorp/external&quot;
      version = &quot;2.3.4&quot;
    }

    aws = {
      source  = &quot;hashicorp/aws&quot;
      version = &quot;5.82.2&quot;
    }
  }
}

</code></pre>
<p><strong>health.py</strong></p>
<pre><code>import boto3
import json
import sys
import subprocess

def get_active_aws_health_region():
    &quot;&quot;&quot;
    Retrieve the active AWS Health API region by resolving the global.health.amazonaws.com CNAME.

    Returns:
        str: The active region endpoint (e.g., 'health.us-east-1.amazonaws.com') or None if unsuccessful.
    &quot;&quot;&quot;
    try:
        result = subprocess.run(
            [&quot;dig&quot;, &quot;global.health.amazonaws.com&quot;, &quot;+short&quot;],
            capture_output=True,
            text=True
        )

        # Extract the CNAME from the output
        for line in result.stdout.splitlines():
            if line.endswith(&quot;.amazonaws.com.&quot;):
                active_endpoint = str(line.strip().split(&quot;.&quot;)[1])
                return active_endpoint

    except Exception as e:
        print(f&quot;Error retrieving active AWS Health region: {e}&quot;)

    return None

def get_aws_health_events(services, event_status_codes, regions):
    &quot;&quot;&quot;
    Fetch AWS Health events based on filter criteria and return a JSON object suitable for Terraform Data block.

    Parameters:
        services (list): List of AWS services to filter (e.g., [&quot;EC2&quot;]).
        event_status_codes (list): List of event statuses (e.g., [&quot;open&quot;, &quot;upcoming&quot;]).
        regions (list): List of regions to filter (e.g., [&quot;eu-north-1&quot;]).

    Returns:
        dict: JSON object containing the events as a string.
    &quot;&quot;&quot;
    # Create a Boto3 Health client
    active_aws_health_region = get_active_aws_health_region()
    health_client = boto3.client('health', region_name=active_aws_health_region)

    # Define the filter criteria
    filter_criteria = {
        &quot;services&quot;: services,
        &quot;eventStatusCodes&quot;: event_status_codes,
        &quot;regions&quot;: regions
    }

    try:
        # Call the AWS Health DescribeEvents API
        response = health_client.describe_events(
            filter=filter_criteria
        )

        # Extract only the events
        events = response.get(&quot;events&quot;, [])
        return {&quot;events&quot;: json.dumps(events), &quot;active_aws_health_region&quot;: active_aws_health_region}

    except health_client.exceptions.SubscriptionRequiredException as e:
        return {&quot;error&quot;: &quot;A Business or Enterprise Support plan is required.&quot;}

    except Exception as e:
        return {&quot;error&quot;: &quot;An unexpected error occurred.&quot;}


if __name__ == &quot;__main__&quot;:
    # Parse input from Terraform
    input_params = json.load(sys.stdin)
    services = input_params.get(&quot;services&quot;, &quot;&quot;).split(&quot;,&quot;)
    event_status_codes = [&quot;open&quot;, &quot;upcoming&quot;]  # Fixed as per original request
    regions = input_params.get(&quot;regions&quot;, &quot;&quot;).split(&quot;,&quot;)

    result = get_aws_health_events(services, event_status_codes, regions)

    print(json.dumps(result))

</code></pre>
<p>The below code block shows the terraform output result:</p>
<pre><code>Changes to Outputs:
  + health_active_endpoint = &quot;us-east-1&quot;
  + health_events          = jsonencode([])
</code></pre>
<p>You can also find this example in my GitHub project repository: <a href="https://github.com/meraj-kashi/aws-health-within-terraform" target="_blank">aws-health-within-terraform</a></p>
<h2 id="discussion">Discussion</h2>
<p>Resilience is not an isolated consideration—it must be integrated into operations and design. Avoid relying solely on default configurations; instead, tailor your system to meet operational needs. Checking AWS Health before deployments is crucial, particularly if deployments occur frequently. It’s equally important to consider all stakeholders and components that play critical roles in ensuring your service availability.</p>
<p>A common question arises: <em>If a service is unhealthy, should we always stop the deployment?</em> The answer depends on the type of change or deployment. However, according to the AWS Well-Architected Framework guideline <a href="https://docs.aws.amazon.com/wellarchitected/latest/framework/ops_mit_deploy_risks_plan_for_unsucessful_changes.html" target="_blank">OPS06-BP01</a> - Plan for Unsuccessful Changes, the recommended approach is to plan to revert to a known good state or implement remediation strategies in the production environment to address any undesired outcomes caused by the deployment.</p>
<p>Another point of debate regarding AWS Health is: <em>Why doesn’t AWS automatically prevent customer activities that might interfere with ongoing AWS maintenance or service disruptions?</em> While this could improve resiliency and reduce errors, such a feature does not currently exist. This idea could be proposed to AWS through their working backward process as a potential feature request.</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 6, 2025</span>
      
    
  </small>
</div>


  




  <h2 id="__comments">Comments</h2>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js"
        data-repo="cloudynotes/comments"
        data-repo-id="R_kgDOJAy0uA"
        data-category="Announcements"
        data-category-id="DIC_kwDOJAy0uM4CUXOl"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - 2025 CloudyNotes
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/meraj-kashi/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.top", "navigation.footer", "content.code.copy"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
    
  </body>
</html>